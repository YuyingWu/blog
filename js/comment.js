!function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/app/",e(e.s=3)}([function(t,e,n){"use strict";var o=n(1),r=function(t){return t&&t.__esModule?t:{default:t}}(o);AV.init({appId:"wPyQjUmvJiSYs1ovT7uGsNE0-gzGzoHsz",appKey:"j182JIXghHrneWAiBDaqmuhR"}),new r.default({permalink:$("#wgt-comment").data("permalink"),dbComment:"Comment"})},function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=n(2),c=(function(t){t&&t.__esModule}(i),function(){function t(e){o(this,t),this.props=Object.assign({dbComment:"Comment"},e),this.checkSetup()&&(this.sessionAuthor="commentAuthor",this.comments={},this.init(e))}return a(t,[{key:"checkSetup",value:function(){var t=[{key:"permalink",pass:!1}];return this.props.permalink?t.find(function(t){return"permalink"==t.key}).pass=!0:console.error("permalink required, which is the unique id for comments."),t.every(function(t){return 1==t.pass})}}]),a(t,[{key:"formatData",value:function(t){var e=function(t){var e=t.id,n=t.createdAt;return r({id:e,createdAt:n},t.attributes)};if(!t.length)return t.id?e(t):[];var n=[];return t.map(function(t){n.push(e(t))}),n}},{key:"init",value:function(t){var e=this,n=new AV.Query(this.props.dbComment);n.equalTo("permalink",this.props.permalink),n.find().then(function(t){var n=e.formatData(t);n.map(function(t){e.comments[t.id]=t}),e.render(n)},function(t){this.errorDeal(t)});var o=sessionStorage.getItem(this.sessionAuthor);o&&$(".comment__contentAuthor").val(o),this.eventHandler()}},{key:"eventHandler",value:function(){var t=this;$("input").on("keyup",function(){var t=$(this),e=+t.attr("max-length");this.value.length>=e&&t.val(this.value.trim().substring(0,e))});var e=$("#comment-form");e.on("click","#comment-box-submit",function(n){if(n.preventDefault(),!$(n.target).hasClass("disabled")){var o=e.serializeArray();if(t.lockSubmit(!0),t.validate(o)){var r=$(".comment__contentAuthor").val();r!=(sessionStorage.getItem(t.sessionAuthor)||"")&&sessionStorage.setItem(t.sessionAuthor,r),t.submitParams(o,function(e){t.saveToDB(t.props.dbComment,e,function(e){$("#comment-list").append(t.commentSingle(t.formatData(e),"comment__item")),t.resetPlaceholder("content"),t.lockSubmit(!1)},function(e){t.errorDeal(e),t.lockSubmit(!1)})})}else t.displayErrorMsg("#comment-form-footer","ÊòµÁß∞ÂíåËØÑËÆ∫Âú®‰∏ÄËµ∑ÊâçÊòØÊúÄÂ•ΩÁöÑ ^_^"),t.lockSubmit(!1)}}),$("#comment-list").on("click",".btn-reply",function(t){t.preventDefault();var n=$(this),o=n.data("content");window.location.href="#comment-form",$(".comment__replyComment").length?$(".comment__replyComment").find("pre").html(o):$('<div class="comment--clearfix comment--mb10 comment--fontsizeMeta comment__replyComment"/>').html('\n\t\t\t\t\t<span class="comment--grid-r comment__replyCancel">x</span>\n\t\t\t\t\t<pre>'+o+"</pre>\n\t\t\t\t").insertBefore(e),e.find('[name="parentId"]').val(n.attr("data-id"))}),$("#wgt-comment").on("click",".comment__replyCancel",function(){var t=$(this).parent(".comment__replyComment");e.find('[name="parentId"]').val(""),t.remove()})}},{key:"validate",value:function(t){return t.every(function(t){var e=$("[name="+t.name+"]"),n=+e.attr("max-length"),o=e.attr("required");switch(t.name){case"author":case"content":return o&&!!t.value&&t.value.length<n;default:return!0}})}},{key:"errorDeal",value:function(t){console.error(t),t&&t.code&&t.error?alert("Âí¶ÔºåËØ∑Ê±ÇÂá∫Èîô‰∫Üüò±üò±üò±È∫ªÁÉ¶Êà™ÂõæËÅîÁ≥ªÁÆ°ÁêÜÂëòÔºåÈîôËØØ‰ø°ÊÅØ‰∏∫ -> code:"+t.code+", error:"+t.error+"„ÄÇ"):alert("Âí¶ÔºåËØ∑Ê±ÇÂá∫Èîô‰∫ÜÔºåÈ∫ªÁÉ¶ËÅîÁ≥ªÁÆ°ÁêÜÂëòüò±üò±üò±"),this.lockSubmit(!1)}},{key:"saveToDB",value:function(t,e,n){var o=AV.Object.extend(t),r=new o;if(r.set(e),e.parentId){var a=AV.Object.createWithoutData("Comment",e.parentId);r.set("parentComment",a)}r.save().then(function(t){n(t)},function(t){this.errorDeal(t)})}},{key:"submitParams",value:function(t,e){var n={permalink:this.props.permalink};t.map(function(t){n[t.name]=t.value}),e(n)}},{key:"lockSubmit",value:function(t){var e=$("#comment-form"),n=$("#comment-box-submit");t?(e.find("input").each(function(){$(this).attr("disabled","disabled")}),n.addClass("disabled")):e.find("input").each(function(){$(this).removeAttr("disabled"),n.removeClass("disabled")})}},{key:"resetPlaceholder",value:function(t){switch(t){case"author":$(".comment__contentAuthor").val("");break;case"content":$(".comment__contentInput").val("")}var e=$(".comment__replyCancel");e.length&&e.click()}},{key:"commentSingle",value:function(t,e){var n="",o=t.parentId;if(o){var r=this.comments[o],a="";r&&r.content&&(a=r.content,a.length>20&&(a=a.substring(0,20)+"..."),n='\n\t\t\t\t\t<blockquote class="comment--fontsizeMeta comment__quote">\n\t\t\t\t\t\t<p>'+a+'\n\t\t\t\t\t\t\t<span class="comment--colorAccent">'+r.author+"</span>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</blockquote>\n\t\t\t\t")}return'\n\t\t\t<div class="'+e+'" id="comment-'+t.id+'">\n\t\t\t\t<article>\n\t\t\t\t\t<header class="comment__header">\n\t\t\t\t\t\t<span class="comment--colorAccent comment--fontsizeMeta comment__item--author">'+t.author+' </span>\n\t\t\t\t\t\t<time class="comment--colorMeta comment--fontsizeMeta comment__item--time">'+moment(t.createdAt).format("MM-DD-YYYY hh:mm:ss")+'</time>\n\t\t\t\t\t</header>\n\t\t\t\t\t<section class="comment--mt10">\n\t\t\t\t\t\t'+n+'\n\t\t\t\t\t\t<pre class="comment__content">'+t.content+'</pre>\n\t\t\t\t\t</section>\n\t\t\t\t\t<footer class="comment--tRight">\n\t\t\t\t\t\t<a href="#" class="comment--fontsizeMeta comment--colorAccent btn-reply" data-id="'+t.id+'" data-content="'+t.content.substring(0,20)+'">ÂõûÂ§ç</a>\n\t\t\t\t\t</footer>\n\t\t\t\t</article>\n\t\t\t</div>\n\t\t'}},{key:"render",value:function(t){var e=this,n="";if(!t.length)return n="<p class=\"comment--colorAccent comment__pEmpty\">Âø´Êù•Êä¢Âç†Ê≤ôÂèëÂêß~</p>",$("#comment-list").html(n),!1;Object.keys(t).map(function(o){var r=t[o];if(r.author&&r.content&&r.display){var a=e.commentSingle(r,"comment__item");n+="\n\t\t\t\t"+a+"\n\t\t\t"}}),$("#comment-list").html(n)}},{key:"displayErrorMsg",value:function(t,e){var n=$("#comment-form-error");n.length?n.html(e).show():(n=$("<p/>").attr({class:"comment--grid comment--fontsizeMeta comment--colorError",id:"comment-form-error"}).html(e),$(t).append(n)),setTimeout(function(){n.hide()},2e3)}}]),t}());e.default=c},function(t,e){},function(t,e,n){t.exports=n(0)}]);