

<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="renderer" content="webkit">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="description" content="">

	
<link rel="stylesheet" href="/blog//css/post.css">


	<title>JavaScript网页动画设计：velocity.js - 伍酱</title>

	<!--[if lte IE 8]>
        <script>
            (function(){
                var e="abbr,article,aside,audio,canvas,datalist,details,dialog,eventsource,figure,footer,header,hgroup,mark,menu,meter,nav,output,progress,section,time,video".split(","),
                i=e.length;
                while(i--){document.createElement(e[i])}
             })();
        </script>
    <![endif]-->
</head>
<body class="page-post">

<script async>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-74424222-1', 'auto');
	ga('send', 'pageview');
</script>


<!--[if lte IE 8]>
    <p class="browserupgrade">貌似你还在用<strong>低版本IE</strong>浏览器喔~ 为了更好的体验，去下载一个<a href="https://www.baidu.com/s?ie=utf-8&f=8&rsv_bp=0&rsv_idx=1&tn=baidu&wd=chrome&rsv_pq=c275ed8c0000204b&rsv_t=b404%2BiFxvZfvn%2FqqBMyJKwHyShj%2FipQgL7TfJsGKrHxZhoWCUisbVukJsNw&rqlang=cn&rsv_enter=1&rsv_sug3=6&rsv_sug1=5&rsv_sug7=100&rsv_sug2=0&inputT=891&rsv_sug4=891" target="_blank">最新版Chrome</a>吧 ：）</p>
<![endif]-->


	<header>
	<section class="u-clearfix header__container">
		<nav class="grid-r header__nav--list">
			
				<a href="/blog/">Blog</a>
			
				<a href="/blog/archives/">Archive</a>
			
				<a href="/blog/about.html">About</a>
			
		</nav>

		<h1 class="grid">
			<a href="/">伍酱</a>
		</h1>
	</section>
</header><!-- /header -->


<div id="content">
	<div class="center">
		<div class="main-col">
			
	
	<article class="article article-detail post article-post">
	<div class="post-content">
		<header>
			
	
		
			<h1 class="title" data-role="articleTitle">JavaScript网页动画设计：velocity.js</h1>
		
	

			<div class="post__meta">
	<time datetime="2016-04-22T08:46:19.000Z">2016-04-22</time>

	
</div>
			
		</header>

		<div class="entry">
			<aside class="wgt-toc">
				<header>
					<p><i class="iconfont icon-folder"></i>&nbsp;文章大纲</p>
				</header>
				<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、动画代码优化"><span class="toc-number">1.</span> <span class="toc-text">一、动画代码优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、动画工作流"><span class="toc-number">2.</span> <span class="toc-text">二、动画工作流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-传统方式：按照动画顺序，完成一个元素的动画后，callback里嵌套另一个元素的动画"><span class="toc-number">2.1.</span> <span class="toc-text">1. 传统方式：按照动画顺序，完成一个元素的动画后，callback里嵌套另一个元素的动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-velocity序列触发（UI-pack）"><span class="toc-number">2.2.</span> <span class="toc-text">2. velocity序列触发（UI pack）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-设计技巧"><span class="toc-number">2.3.</span> <span class="toc-text">3. 设计技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-定义全局定时乘数"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1 定义全局定时乘数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-VMD-动效设计器"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2 VMD 动效设计器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、文本动画"><span class="toc-number">3.</span> <span class="toc-text">三、文本动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、最佳实践"><span class="toc-number">4.</span> <span class="toc-text">四、最佳实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">5.</span> <span class="toc-text">Reference</span></a></li></ol>
			</aside>
			<p>最近读了一本讲js动画的书<a href="https://book.douban.com/subject/26694195/" target="_blank" rel="noopener">《JavaScript网页动画设计》</a>，看了开头就知道是本<a href="http://www.julian.com/research/velocity/" target="_blank" rel="noopener">velocity.js</a>的大型广告书，但不得不说，这个动画库可以给日常的动画开发带来许多的便利，在书中我也get到了一些动画开发的新思路，推荐一下~</p>
<a id="more"></a>
<h2 id="一、动画代码优化"><a href="#一、动画代码优化" class="headerlink" title="一、动画代码优化"></a>一、动画代码优化</h2><ul>
<li>单独把动画逻辑的js抽离成独立的文件</li>
<li>定义一个对象（以动画目标命名），根据我们所需动画的设定，抽离出需要维护的参数，如动画的属性和选项</li>
</ul>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var fadeIn = &#123;</span><br><span class="line">    <span class="comment">// p -&gt; properties</span></span><br><span class="line"><span class="symbol">    p:</span> &#123;</span><br><span class="line"><span class="symbol">        opacity:</span> <span class="number">1</span>,</span><br><span class="line"><span class="symbol">        top:</span> <span class="string">"50px"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// o -&gt; options</span></span><br><span class="line"><span class="symbol">    o:</span> &#123;</span><br><span class="line"><span class="symbol">        duration:</span> <span class="number">1000</span>,</span><br><span class="line"><span class="symbol">        easing:</span> <span class="string">"linear"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$element.velocity(fadeIn.p, fadeIn.o);</span><br></pre></td></tr></table></figure>
<h2 id="二、动画工作流"><a href="#二、动画工作流" class="headerlink" title="二、动画工作流"></a>二、动画工作流</h2><h3 id="1-传统方式：按照动画顺序，完成一个元素的动画后，callback里嵌套另一个元素的动画"><a href="#1-传统方式：按照动画顺序，完成一个元素的动画后，callback里嵌套另一个元素的动画" class="headerlink" title="1. 传统方式：按照动画顺序，完成一个元素的动画后，callback里嵌套另一个元素的动画"></a>1. 传统方式：按照动画顺序，完成一个元素的动画后，callback里嵌套另一个元素的动画</h3><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 设置element1的动画,紧接着设置element2的动画,紧接着设置element3的动画 $element1.velocity(&#123; translateX: <span class="number">100</span>, opacity: <span class="number">1</span> &#125;, <span class="number">1000</span>, <span class="keyword">function</span>() &#123;</span><br><span class="line">$element2.velocity(&#123; translateX: <span class="number">200</span>, opacity: <span class="number">1</span> &#125;, <span class="number">1000</span>, function() &#123; $element3.velocity(&#123; translateX: <span class="number">300</span>, opacity: <span class="number">1</span> &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;); <span class="number">3</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>缺点：</p>
<ul>
<li>因为每一级都有嵌套,因此代码在横向上会迅速变长,这使得在IDE中编辑代码越来越 困难。</li>
<li>在整个序列中,都无法轻易重新调整调用的顺序。(如果要调整的话,需要非常小心地复 制粘贴。)</li>
<li>无法轻易指明哪些调用应该是并行运行的。比如在整个序列运行到一半的时候,想让两 幅图片从不同的起始点滑入视图。把这段代码写进去以后,怎么样嵌套并行的小序列之 后发生的动画,同时又不让原本已经难以维护的代码变得难上加难,就不是那么轻易能 办得到了。</li>
</ul>
<h3 id="2-velocity序列触发（UI-pack）"><a href="#2-velocity序列触发（UI-pack）" class="headerlink" title="2. velocity序列触发（UI pack）"></a>2. velocity序列触发（UI pack）</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 Velocity 调用的数组 </span></span><br><span class="line">var loadingSequence = [</span><br><span class="line">&#123; <span class="string">e:</span> $element1, <span class="string">p:</span> &#123; <span class="string">translateX:</span> <span class="number">100</span>, <span class="string">opacity:</span> <span class="number">1</span> &#125;, <span class="string">o:</span> &#123; <span class="string">duration:</span> <span class="number">1000</span> &#125; &#125;, &#123; <span class="string">e:</span> $element2, <span class="string">p:</span> &#123; <span class="string">translateX:</span> <span class="number">200</span>, <span class="string">opacity:</span> <span class="number">1</span> &#125;, <span class="string">o:</span> &#123; <span class="string">duration:</span> <span class="number">1000</span>,  <span class="string">sequenceQueue:</span> <span class="literal">false</span> &#125; &#125;, &#123; <span class="string">e:</span> $element3, <span class="string">p:</span> &#123; <span class="string">translateX:</span> <span class="number">300</span>, <span class="string">opacity:</span> <span class="number">1</span> &#125;, <span class="string">o:</span> &#123; <span class="string">duration:</span> <span class="number">1000</span> &#125; &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将数组传入 $.Velocity.RunSequence 函数中以启动序列 </span></span><br><span class="line">$.Velocity.RunSequence(loadingSequence);</span><br></pre></td></tr></table></figure>
<p>优点：</p>
<ul>
<li>可以很容易地对整个序列重新排序,不需要担心破坏了嵌套结构。</li>
<li>可以迅速看出各个调用的属性和选项的不同之处。</li>
<li>你的代码对别人来说也非常易读,其意图也一目了然。</li>
<li>$element2的option中，设置了sequenceQueue:false，使得$element1和$element2会并行触发</li>
</ul>
<h3 id="3-设计技巧"><a href="#3-设计技巧" class="headerlink" title="3. 设计技巧"></a>3. 设计技巧</h3><h4 id="3-1-定义全局定时乘数"><a href="#3-1-定义全局定时乘数" class="headerlink" title="3.1 定义全局定时乘数"></a>3.1 定义全局定时乘数</h4><p>在每个动画调用中，将这个乘数与duration和delay选项值相乘</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var M = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">$element1.animate(&#123; opacity: <span class="number">1</span> &#125;, &#123; duration: <span class="number">1000</span> * M &#125;); $element2.velocity(&#123; opacity: <span class="number">1</span> &#125;, &#123; delay: <span class="number">250</span> * M &#125;);</span><br></pre></td></tr></table></figure>
<p>好处：</p>
<ul>
<li>慢速可以更容易分析单个元素如何跟其他元素互动</li>
<li>执行重复性UI测试，方便加快动画播放速度</li>
</ul>
<p>Tips:<br>Velocity中的方法能实现类似的功能：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">.Velocity.mock = 5;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-VMD-动效设计器"><a href="#3-2-VMD-动效设计器" class="headerlink" title="3.2 VMD 动效设计器"></a>3.2 VMD 动效设计器</h4><p><a href="http://julian.com/research/velocity/#vmd" target="_blank" rel="noopener">VMD</a></p>
<h2 id="三、文本动画"><a href="#三、文本动画" class="headerlink" title="三、文本动画"></a>三、文本动画</h2><p>字符串切割的js插件：<a href="Julian.com/research/blast">blast</a><br>以sentence、word、character切割文本，添加blast或者自定义classname</p>
<ul>
<li>用blast切割文本</li>
<li>把文本元素隐藏</li>
<li>逐个元素动画相继延迟出现</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 选择之前已拆分的文本 </span></span><br><span class="line">$(<span class="string">"div .blast"</span>).velocity(</span><br><span class="line">    <span class="comment">// 使用适当的UI pack效果让现有文本以动画方式离开视图     "transition.fadeOut",</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 像错开进入动画一样错开离开动画</span></span><br><span class="line">        stagger: <span class="number">50</span>,</span><br><span class="line">        backwards: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 当文本离开视图的动画完成以后,开始文本进入视图的动画 </span></span><br><span class="line">        complete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 继续进行文本进入视图的动画 </span></span><br><span class="line">            $(<span class="string">"div"</span>)</span><br><span class="line">                .html(message)</span><br><span class="line">                .blast(&#123; <span class="attr">delimiter</span>: <span class="string">"word"</span>&#125;)</span><br><span class="line">                .css(<span class="string">"opacity"</span>: <span class="number">0</span>)</span><br><span class="line">                .velocity(&#123;<span class="attr">opacity</span>: <span class="number">1</span>&#125;, &#123;<span class="attr">stagger</span>: <span class="number">50</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="四、最佳实践"><a href="#四、最佳实践" class="headerlink" title="四、最佳实践"></a>四、最佳实践</h2><ul>
<li>减少dom元素重复查询，尽量复用变量</li>
<li>监听scroll或者resize时，对事件句柄进行反跳（<a href="davidwalsh.name/javascript-debounce-function">debounce</a>）</li>
<li>当检测到用户使用性能较弱的浏览器，使所有动画立即完成</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">.Velocity.mock = <span class="literal">true</span>;</span></span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://webflow.com/" target="_blank" rel="noopener">webflow</a></li>
<li><a href="https://github.com/jonitrythall/svgpocketguide" target="_blank" rel="noopener">SVG口袋指南</a></li>
</ul>

		</div>

		<footer>
			
	<section class="post__meta post__tag">
		
			<a href="/blog/tags/tech/">tech</a>
		
			<a href="/blog/tags/reading/">reading</a>
		
			<a href="/blog/tags/javascript-animation/">javascript animation</a>
		
			<a href="/blog/tags/animate/">animate</a>
		
			<a href="/blog/tags/velocity-js/">velocity.js</a>
		
	</section>

			<section class="post__meta">
	<a href="/blog/donate.html" title="码字辛苦求打赏" class="u-clearfix wgt-shield">
		<span class="title">Donate</span>
		<span class="desc">￥￥￥</span>
	</a>

	<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" 
		title="知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议" class="u-clearfix wgt-shield">
		<span class="title">License</span>
		<span class="desc">CC BY-NC-SA</span>
	</a>
</section>
		</footer>

		
			<section id="wgt-comment" class="wgt-comment" data-permalink="/archives/javascript-animation/">
	<div id="comment-list">
		<article>暂无数据</article>
	</div>

	<form id="comment-form" class="comment__form">
		<input type="text" 
			name="author" 
			class="comment--mb10 comment__contentAuthor" 
			required 
			max-length="15"
			placeholder="这里输入你的名字" />
		<input type="text" 
			name="content" 
			class="comment--mb10 comment__contentInput" 
			required
			max-length="150"
			placeholder="这里输入评论内容" />
		<input type="hidden" name="parentId" id="comment-reply-id" />
		<!-- <label>
			<span>Email: </span>
			<input type="email" name="email">
		</label>
		<label>
			<span>website: </span>
			<input type="url" name="website">
		</label> -->

		<footer class="comment--clearfix comment--tRight" id="comment-form-footer">
			<a id="comment-box-submit" class="comment--fontsizeMeta comment--colorAccent comment__submitReply">加上去</a>
		</footer>
	</form>
</section>
		
	</div>
</article>

		</div>
		
	</div>
</div>

<link rel="stylesheet" href="/blog//build/css/iconfont_201704181501.css">


	<footer class="wgt-footer" id="footer">
	<div class="center">
		<p>
		&copy; 
		2014-2018

		
			<a href="/blog/">Yuying Wu</a>
		

		&nbsp;|&nbsp;
		<a href="https://github.com/YuyingWu"><i class="iconfont icon-github"></i> Github</a>&nbsp;|&nbsp;
<a href="http://www.weibo.com/wuyuying1128"><i class="iconfont icon-weibo"></i> 微博</a>&nbsp;|&nbsp;
<a href="http://www.douban.com/people/wuyuying1128/"><i class="iconfont icon-douban"></i>豆瓣</a>
		</p>
		<p>
			京ICP备16019960号&nbsp;
			Powered by 
			<a href="https://hexo.io" target="_blank">Hexo</a>, using theme 
			<a href="https://github.com/YuyingWu/hexo-theme-fresh" 
				target="_blank">Fresh</a>
		.</p>
	</div>
</footer>



<script src="http://cdn1.lncld.net/static/js/2.1.4/av-min.js"></script>
<script src="http://apps.bdimg.com/libs/zepto/1.1.4/zepto.min.js"></script>
<script src="http://cdn.bootcss.com/moment.js/2.18.1/moment.min.js"></script>
<script src="/blog//build/js/comment.js"></script>


<script src="//sinacloud.net/woodysblog/statics/lazyload.js"></script>
<script>
	new LazyLoad({
		threshold: 600
	});
</script>
<script src="/blog//dist/base.js"></script>
</body>
</html>