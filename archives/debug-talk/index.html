

<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="renderer" content="webkit">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="description" content="">

	
<link rel="stylesheet" href="/blog//css/post.css">


	<title>谈谈怎么在不熟悉上下文的情况下debug - 小伍</title>

	<!--[if lte IE 8]>
        <script>
            (function(){
                var e="abbr,article,aside,audio,canvas,datalist,details,dialog,eventsource,figure,footer,header,hgroup,mark,menu,meter,nav,output,progress,section,time,video".split(","),
                i=e.length;
                while(i--){document.createElement(e[i])}
             })();
        </script>
    <![endif]-->
</head>
<body class="page-post">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-74424222-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74424222-3');
</script>


<!--[if lte IE 8]>
    <p class="browserupgrade">貌似你还在用<strong>低版本IE</strong>浏览器喔~ 为了更好的体验，去下载一个<a href="https://www.baidu.com/s?ie=utf-8&f=8&rsv_bp=0&rsv_idx=1&tn=baidu&wd=chrome&rsv_pq=c275ed8c0000204b&rsv_t=b404%2BiFxvZfvn%2FqqBMyJKwHyShj%2FipQgL7TfJsGKrHxZhoWCUisbVukJsNw&rqlang=cn&rsv_enter=1&rsv_sug3=6&rsv_sug1=5&rsv_sug7=100&rsv_sug2=0&inputT=891&rsv_sug4=891" target="_blank">最新版Chrome</a>吧 ：）</p>
<![endif]-->


	<header>
	<section class="u-clearfix header__container">
		<nav class="grid-r header__nav--list">
			
				<a href="/blog/">Blog</a>
			
				<a href="/blog/archives/">Archive</a>
			
				<a href="/blog/about.html">About</a>
			
		</nav>

		<h1 class="grid">
			<a href="/">小伍</a>
		</h1>
	</section>
</header><!-- /header -->


<div id="content">
	<div class="center">
		<div class="main-col">
			
	
	<article class="article article-detail post article-post">
	<div class="post-content">
		<header>
			
	
		
			<h1 class="title" data-role="articleTitle">谈谈怎么在不熟悉上下文的情况下debug</h1>
		
	

			<div class="post__meta">
	<time datetime="2017-02-27T13:56:02.000Z">2017-02-27</time>

	
</div>
			
		</header>

		<div class="entry">
			<aside class="wgt-toc">
				<header>
					<p><i class="iconfont icon-folder"></i>&nbsp;文章大纲</p>
				</header>
				<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#问题定位"><span class="toc-number">1.</span> <span class="toc-text">问题定位</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#button"><span class="toc-number">1.1.</span> <span class="toc-text">button</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#handleLangChange"><span class="toc-number">1.2.</span> <span class="toc-text">handleLangChange</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getLocalizedPathname"><span class="toc-number">1.3.</span> <span class="toc-text">getLocalizedPathname</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#怎么调试和修bug"><span class="toc-number">2.</span> <span class="toc-text">怎么调试和修bug</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结语"><span class="toc-number">3.</span> <span class="toc-text">结语</span></a></li></ol>
			</aside>
			<p>跟大家分享一个最近调bug的故事，在不熟悉架构、业务上下文、编程语言、调试环境等等的情况下，遇到问题时，我们可以怎么解决。简单的来说，路过一个你喜欢的站点，发现页面有bug，想帮忙修，怎么办？<br><a id="more"></a></p>
<hr>
<p>偶然访问了阿里<a href="https://ant.design/" target="_blank" rel="noopener">Ant Design</a>，默认是英文版本，我看右上角有个切换到中文的按钮，就过去一点，咦，跳到错误页了~</p>
<p><img src="http://cdn.sinacloud.net/woodysblog/articles/en-to-zh.png" alt=""></p>
<p>职业习惯，我在chrome和Safari都测了一下，稳定浮现，bug~<br>恰好这个站点是开源的，那就去github fork一下，把这个bug修了吧。</p>
<p>原href：<a href="https://ant.design/" target="_blank" rel="noopener">https://ant.design/</a><br>正确跳转href：<a href="https://ant.design/index-cn" target="_blank" rel="noopener">https://ant.design/index-cn</a><br>Chrome下跳转到：<a href="https://ant.design/index-cn/ant.design/" target="_blank" rel="noopener">https://ant.design/index-cn/ant.design/</a><br>Safari下跳转到：<a href="https://index-cn/ant.design/" target="_blank" rel="noopener">https://index-cn/ant.design/</a></p>
<h2 id="问题定位"><a href="#问题定位" class="headerlink" title="问题定位"></a>问题定位</h2><p>咋眼一看，我以为是程序猿或者PM在配置时写错了，于是我打开console，检查这个按钮的元素，看有什么关键字（url、data-属性、id、特别的classname等）</p>
<p><img src="http://cdn.sinacloud.net/woodysblog/articles/antd-button.png" alt=""></p>
<p>没有链接，看来是js控制的，那就去翻源码吧~问题来了，怎么翻呢？</p>
<p>从上图看，这个<code>button</code>没什么特色，不过，仔细一看，有个不太普通的类名，<code>ant-btn-ghost</code>，那我们就去模板那搜<code>ghost</code>吧！</p>
<p><img src="http://cdn.sinacloud.net/woodysblog/articles/antd-folder.png" alt=""></p>
<p>从目录可以看出来，整个源是非常庞大的，除了官网页面、文档，还有Ant Design UI库的源码。凭”直觉“，到<code>site</code>文件夹搜<code>ghost</code>，因为那么多文件夹，就site比较像是放官网的。</p>
<p>Bingo!!!</p>
<p><img src="http://cdn.sinacloud.net/woodysblog/articles/antd-search.png" alt=""></p>
<h3 id="button"><a href="#button" class="headerlink" title="button"></a>button</h3><p>看看<code>button</code>相关的代码，虽然我不太懂React.js，但不难看出来，<code>button</code>的<code>click</code>事件处理函数<code>handleLangChange</code>就是我们要找的逻辑~</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">className</span>=<span class="string">"lang"</span> <span class="attr">type</span>=<span class="string">"ghost"</span> <span class="attr">size</span>=<span class="string">"small"</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleLangChange&#125;</span> <span class="attr">key</span>=<span class="string">"lang"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">FormattedMessage</span> <span class="attr">id</span>=<span class="string">"app.header.lang"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="handleLangChange"><a href="#handleLangChange" class="headerlink" title="handleLangChange"></a>handleLangChange</h3><p>接下来去看<code>handleLangChange</code>函数，幸好代码不是很多，简单扫一眼~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">handleLangChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> pathname = <span class="keyword">this</span>.props.location.pathname;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (utils.isLocalStorageNameSupported()) &#123;</span><br><span class="line">    localStorage.setItem(<span class="string">'locale'</span>, utils.isZhCN(pathname) ? <span class="string">'en-US'</span> : <span class="string">'zh-CN'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  location.href = location.href.replace(</span><br><span class="line">    location.pathname,</span><br><span class="line">    utils.getLocalizedPathname(pathname, !utils.isZhCN(pathname)),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一句，变量声明，忽略；<br>第二段，localstorage，忽略；<br>第三段，replace，参数1是当前地址，参数2那段的<code>utils.getLocalizedPathname</code>是什么意思呢？</p>
<h3 id="getLocalizedPathname"><a href="#getLocalizedPathname" class="headerlink" title="getLocalizedPathname"></a>getLocalizedPathname</h3><p>在<code>site</code>文件夹再搜搜<code>getLocalizedPathname</code>，在<code>utils.jsx</code>找到了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getLocalizedPathname</span>(<span class="params">path, zhCN</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> pathname = path.startsWith(<span class="string">'/'</span>) ? path : <span class="string">`/<span class="subst">$&#123;path&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!zhCN) &#123; <span class="comment">// to enUS</span></span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/\/?index-cn/</span>.test(pathname) ? <span class="string">'/'</span> : pathname.replace(<span class="string">'-cn'</span>, <span class="string">''</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname === <span class="string">'/'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'/index-cn'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname.endsWith(<span class="string">'/'</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> pathname.replace(<span class="regexp">/\/$/</span>, <span class="string">'-cn/'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;pathname&#125;</span>-cn`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们再轻轻扫一眼，可以发现函数<code>getLocalizedPathname</code>的作用是根据当前路径<code>path</code>与是否中文版本<code>zhCN</code>，返回对应path值。</p>
<p>经过上面的排查，我们基本定位切换中文的功能，涉及3个函数：</p>
<ul>
<li>handleLangChange</li>
<li>utils.isZhCN</li>
<li>utils.getLocalizedPathname</li>
</ul>
<p>上面只是跟大家分享<strong>问题定位</strong>的思路，当然不是看看就可以”盲调“啦，哪有辣么厉害，运行调试才是正解！下面开聊<strong>怎么调试和修bug</strong>。</p>
<h2 id="怎么调试和修bug"><a href="#怎么调试和修bug" class="headerlink" title="怎么调试和修bug"></a>怎么调试和修bug</h2><p>我在Github上看到有个<a href="https://github.com/ant-design/ant-design/wiki/Development" target="_blank" rel="noopener">开发指导</a>文档，上面写着这样可以预览调试：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> Fork <span class="keyword">and</span> git clone.</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">npm</span> install</span><br><span class="line">$ <span class="built_in">npm</span> start</span><br></pre></td></tr></table></figure>
<p>我clone到本地，执行<code>npm start</code>后，提示有个npm组件报错，导致编译失败~没办法在线预览和调试。</p>
<p>在这里我遇到两个问题：</p>
<ol>
<li>.jsx文件编译</li>
<li>运行环境不能在线调试 </li>
</ol>
<p>遇到事，咱不怕事，见招拆招就okay啦~</p>
<ol>
<li>把jsx编译成js（或者用babel，具体问题具体分析）</li>
<li>写好demo后，随便用fis或者webpack在线调试就好了</li>
</ol>
<p><strong>针对上面的问题，我的处理方法是，直接把涉及的几个函数串起来，写成demo，想怎么调就怎么调噜~</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="comment">// 判断当前是否中文版本</span></span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">isZhCN</span><span class="params">(pathname)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> (<span class="regexp">/-cn\/?$/</span>.test(pathname));</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="comment">// 根据当前pathname和isZhCN()返回该跳转的相对路径</span></span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">getLocalizedPathname</span><span class="params">(path, zhCN)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> pathname = path.startsWith(<span class="string">'/'</span>) ? path : <span class="string">'/'</span> + path;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">if</span> (!zhCN) &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// to enUS</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> (<span class="regexp">/\/?index-cn/</span>.test(pathname) ? <span class="string">'/'</span> : pathname.replace(<span class="string">'-cn'</span>, <span class="string">''</span>)</span></span><br><span class="line"><span class="undefined">    );</span></span><br><span class="line"><span class="actionscript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname === <span class="string">'/'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="string">'/index-cn'</span>;</span></span><br><span class="line"><span class="actionscript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname.endsWith(<span class="string">'/'</span>)) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> pathname.replace(<span class="regexp">/\/$/</span>, <span class="string">'-cn/'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> pathname + <span class="string">'-cn'</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="comment">// handleLangChange 的简写</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">// 由于当前环境不在https://ant.design域下，我是直接访问demo.html</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">// 原文中的location.pathname，这里使用硬编码替代</span></span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> pathname = <span class="string">'/index-cn'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> result = location.href.replace(</span></span><br><span class="line"><span class="undefined">    location.pathname,</span></span><br><span class="line"><span class="undefined">    getLocalizedPathname(pathname, isZhCN(pathname))</span></span><br><span class="line"><span class="undefined">);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="comment">// 输出测试结果</span></span></span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.log(result);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其实这样也属于盲调，纯本地调试，修bug的原理没错，但是没有实时调试，加上我不了解业务逻辑（我以为只有首页有中英版本切换，没考虑到其他入口也有），导致我提交的第一个版本会丢失hash和query，后续我再PR了一版，修复的详细这里就不详述了。</p>
<p><a href="https://github.com/ant-design/ant-design/pull/5050" target="_blank" rel="noopener">第一版</a> <a href="https://github.com/YuyingWu/ant-design/commit/9c9c164617ec35d9c30e5518f94661601bcd736b" target="_blank" rel="noopener">第二版</a></p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>不懂业务、不了解系统的架构和实现、不懂编程语言、没法实时调试，这些可能会变成我们在问题定位和修复时的拦路虎~但是，不要方，见招拆招，用自己的思路和方式解决 ：）</p>

		</div>

		<footer>
			
	<section class="post__meta post__tag">
		
			<a href="/blog/tags/tech/">tech</a>
		
	</section>

			<section class="post__meta">
	<a href="/blog/donate.html" title="码字辛苦求打赏" class="u-clearfix wgt-shield">
		<span class="title">Donate</span>
		<span class="desc">￥￥￥</span>
	</a>

	<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" 
		title="知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议" class="u-clearfix wgt-shield">
		<span class="title">License</span>
		<span class="desc">CC BY-NC-SA</span>
	</a>
</section>
		</footer>

		
			<section id="wgt-comment" class="wgt-comment" data-permalink="/archives/debug-talk/">
	<div id="comment-list">
		<article>暂无数据</article>
	</div>

	<form id="comment-form" class="comment__form">
		<input type="text" 
			name="author" 
			class="comment--mb10 comment__contentAuthor" 
			required 
			max-length="15"
			placeholder="这里输入你的名字" />
		<input type="text" 
			name="content" 
			class="comment--mb10 comment__contentInput" 
			required
			max-length="150"
			placeholder="这里输入评论内容" />
		<input type="hidden" name="parentId" id="comment-reply-id" />
		<!-- <label>
			<span>Email: </span>
			<input type="email" name="email">
		</label>
		<label>
			<span>website: </span>
			<input type="url" name="website">
		</label> -->

		<footer class="comment--clearfix comment--tRight" id="comment-form-footer">
			<a id="comment-box-submit" class="comment--fontsizeMeta comment--colorAccent comment__submitReply">加上去</a>
		</footer>
	</form>
</section>
		
	</div>
</article>

		</div>
		
	</div>
</div>

<link rel="stylesheet" href="/blog//build/css/iconfont_201704181501.css">


	<footer class="wgt-footer" id="footer">
	<div class="center">
		<p>
		&copy; 
		2014-2019

		
			<a href="/blog/">Yuying Wu</a>
		

		&nbsp;|&nbsp;
		<a href="https://github.com/YuyingWu"><i class="iconfont icon-github"></i> Github</a> | 
<a href="http://wuyuying.com/blog/atom.xml" target="_blank">RSS</a>
		</p>
		<p>
			京ICP备16019960号&nbsp;
			Powered by 
			<a href="https://hexo.io" target="_blank">Hexo</a>, using theme 
			<a href="https://github.com/YuyingWu/hexo-theme-fresh" 
				target="_blank">Fresh</a>
		.</p>
	</div>
</footer>



<script src="http://cdn1.lncld.net/static/js/2.1.4/av-min.js"></script>
<script src="http://apps.bdimg.com/libs/zepto/1.1.4/zepto.min.js"></script>
<script src="http://cdn.bootcss.com/moment.js/2.18.1/moment.min.js"></script>
<script src="/blog//build/js/comment.js"></script>


<script src="//sinacloud.net/woodysblog/statics/lazyload.js"></script>
<script>
	new LazyLoad({
		threshold: 600
	});
</script>
<script src="/blog//dist/base.js"></script>
</body>
</html>